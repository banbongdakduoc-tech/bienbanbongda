<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Biên bản trận đấu</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="app-header">
  <div class="brand">
    <div class="dot"></div>
    <div class="title">Biên bản trận đấu</div>
  </div>
  <div class="header-tools">
    <div class="info-line">
      <span id="statusMsg" class="dim">Chưa hoàn tất</span>
    </div>
    <button id="btnDownloadJSON" class="btn ghost small" disabled>Tải JSON trận</button>
  </div>
</header>

<main class="main">

  <!-- SECTION 1: Thông tin & đội hình -->
  <section class="card">
    <div class="card-header-row">
      <h2>1. Thiết lập trận đấu</h2>
      <div class="subnote">
        Chọn 2 đội từ danh sách đã lưu trong <b>teams.json</b>.
      </div>
    </div>

    <div class="two-col">
      <div class="fc">
        <label>Đội A</label>
        <select id="teamASelect" class="select-dark"></select>
      </div>
      <div class="fc">
        <label>Đội B</label>
        <select id="teamBSelect" class="select-dark"></select>
      </div>
    </div>

    <div class="mt16 note-block">
      Tick để điểm danh cầu thủ ra sân. Danh sách ra sân sẽ được lưu trong biên bản cuối cùng.
    </div>

    <div class="rosters-row mt16">
      <div class="roster-card">
        <div class="roster-head">
          <div class="roster-title"><span id="teamANameLbl">Đội A</span> - Đội hình</div>
        </div>
        <div class="table-wrap roster-table-wrap">
          <table class="table roster-table">
            <thead>
              <tr>
                <th>Ra sân</th>
                <th>Số áo</th>
                <th>Tên cầu thủ</th>
              </tr>
            </thead>
            <tbody id="teamARosterTbody">
              <tr><td colspan="3" class="dim">(chưa chọn đội)</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="roster-card">
        <div class="roster-head">
          <div class="roster-title"><span id="teamBNameLbl">Đội B</span> - Đội hình</div>
        </div>
        <div class="table-wrap roster-table-wrap">
          <table class="table roster-table">
            <thead>
              <tr>
                <th>Ra sân</th>
                <th>Số áo</th>
                <th>Tên cầu thủ</th>
              </tr>
            </thead>
            <tbody id="teamBRosterTbody">
              <tr><td colspan="3" class="dim">(chưa chọn đội)</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 2: Sự kiện bàn thắng / thẻ -->
  <section class="card">
    <div class="card-header-row">
      <h2>2. Sự kiện trận đấu</h2>
      <div class="subnote">
        Thêm bàn thắng và thẻ phạt. Hệ thống sẽ tính tỷ số khi tổng kết.
      </div>
    </div>

    <div class="events-row">
      <!-- Ghi bàn -->
      <div class="event-box">
        <div class="event-title">Bàn thắng</div>
        <div class="fc">
          <label>Đội</label>
          <select id="goalTeamSelect" class="select-dark"></select>
        </div>
        <div class="fc">
          <label>Cầu thủ</label>
          <select id="goalPlayerSelect" class="select-dark"></select>
        </div>
        <div class="two-col">
          <div class="fc">
            <label>Phút</label>
            <input id="goalMinuteInput" class="input-dark" placeholder="VD: 12"/>
          </div>
        </div>
        <button id="btnAddGoal" class="btn green small mt8">+ Thêm bàn thắng</button>

        <div class="table-wrap mt16">
          <table class="table small-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Phút</th>
                <th>Cầu thủ</th>
                <th>Đội</th>
              </tr>
            </thead>
            <tbody id="goalsListTbody">
              <tr><td colspan="4" class="dim">(chưa có)</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Thẻ -->
      <div class="event-box">
        <div class="event-title">Thẻ phạt</div>
        <div class="fc">
          <label>Đội</label>
          <select id="cardTeamSelect" class="select-dark"></select>
        </div>
        <div class="fc">
          <label>Cầu thủ</label>
          <select id="cardPlayerSelect" class="select-dark"></select>
        </div>
        <div class="two-col">
          <div class="fc">
            <label>Phút</label>
            <input id="cardMinuteInput" class="input-dark" placeholder="VD: 30"/>
          </div>
          <div class="fc">
            <label>Loại thẻ</label>
            <select id="cardTypeSelect" class="select-dark">
              <option value="Vàng">Vàng</option>
              <option value="Đỏ">Đỏ</option>
            </select>
          </div>
        </div>
        <button id="btnAddCard" class="btn green small mt8">+ Thêm thẻ</button>

        <div class="table-wrap mt16">
          <table class="table small-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Phút</th>
                <th>Thẻ</th>
                <th>Cầu thủ</th>
                <th>Đội</th>
              </tr>
            </thead>
            <tbody id="cardsListTbody">
              <tr><td colspan="5" class="dim">(chưa có)</td></tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </section>

  <!-- SECTION 3: Hoàn tất & ký -->
  <section class="card">
    <div class="card-header-row">
      <h2>3. Kết thúc trận đấu & Ký biên bản</h2>
      <div class="subnote">
        Sau khi ký xong bạn sẽ nhận được biên bản tổng kết và có thể tải file JSON để dùng cho BXH.
      </div>
    </div>

    <div class="complete-row">
      <button id="btnOpenSign" class="btn green">Kết thúc & ký biên bản</button>
      <div class="dim" style="font-size:13px;line-height:1.4;">
        Lưu ý: Sau khi hoàn tất, nút "Tải JSON trận" ở trên cùng sẽ bật.
      </div>
    </div>
  </section>

  <!-- SECTION 4: Biên bản cuối cùng (ẩn cho đến khi hoàn tất) -->
  <section id="finalSummarySection" class="card hidden">
    <div class="card-header-row">
      <h2>4. Biên bản cuối cùng</h2>
      <div class="subnote">
        Đây là bản chính thức sau khi ký. Bạn chỉ cần copy file JSON tải xuống và đưa vào repo BXH.
      </div>
    </div>

    <div class="final-block">
      <div class="final-line"><b>Thời gian:</b> <span id="finalTimeText"></span></div>
      <div class="final-line"><b>Trọng tài:</b> <span id="finalRefText"></span></div>
      <div class="final-line"><b>Trận đấu:</b> <span id="finalMatchText"></span></div>
      <div class="final-line"><b>Tỷ số:</b> <span id="finalScoreText"></span></div>
    </div>

    <div class="final-sub-block">
      <div class="final-title">Danh sách cầu thủ ra sân</div>
      <div class="final-roster-wrap">
        <div class="final-roster-card">
          <div class="final-roster-head" id="finalTeamATitle">Đội A</div>
          <ul id="finalTeamAList" class="final-roster-list"></ul>
        </div>
        <div class="final-roster-card">
          <div class="final-roster-head" id="finalTeamBTitle">Đội B</div>
          <ul id="finalTeamBList" class="final-roster-list"></ul>
        </div>
      </div>
    </div>

    <div class="final-sub-block">
      <div class="final-title">Bàn thắng</div>
      <div class="table-wrap">
        <table class="table small-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Phút</th>
              <th>Cầu thủ</th>
              <th>Đội</th>
            </tr>
          </thead>
          <tbody id="finalGoalsTbody">
            <tr><td colspan="4" class="dim">(không có)</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="final-sub-block">
      <div class="final-title">Thẻ phạt</div>
      <div class="table-wrap">
        <table class="table small-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Phút</th>
              <th>Loại</th>
              <th>Cầu thủ</th>
              <th>Đội</th>
            </tr>
          </thead>
          <tbody id="finalCardsTbody">
            <tr><td colspan="5" class="dim">(không có)</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="final-sub-block">
      <div class="final-title">Chữ ký</div>
      <div class="sign-wrap-final">
        <div class="sign-final-col">
          <div class="sign-label" id="sigALabel">Đội trưởng A</div>
          <img id="sigAImg" class="sig-preview" alt="chữ ký đội A"/>
        </div>
        <div class="sign-final-col">
          <div class="sign-label" id="sigBLabel">Đội trưởng B</div>
          <img id="sigBImg" class="sig-preview" alt="chữ ký đội B"/>
        </div>
        <div class="sign-final-col">
          <div class="sign-label">Trọng tài</div>
          <img id="sigRefImg" class="sig-preview" alt="chữ ký trọng tài"/>
        </div>
      </div>
    </div>

  </section>
</main>

<!-- MODAL: ký và hoàn tất -->
<div id="signModal" class="modal hidden">
  <div class="modal-bg"></div>
  <div class="modal-card">
    <div class="modal-head">
      <div class="modal-title">Hoàn tất & ký biên bản</div>
      <button class="modal-close-btn" id="btnCloseModal">✕</button>
    </div>

    <div class="modal-body">
      <div class="two-col">
        <div class="fc">
          <label>Ngày thi đấu</label>
          <input id="matchDateInput" class="input-dark" placeholder="YYYY-MM-DD"/>
        </div>
        <div class="fc">
          <label>Giờ thi đấu</label>
          <input id="matchTimeInput" class="input-dark" placeholder="HH:MM"/>
        </div>
      </div>

      <div class="fc mt16">
        <label>Trọng tài</label>
        <input id="refNameInput" class="input-dark" placeholder="Tên trọng tài"/>
      </div>

      <div class="sign-row mt16">
        <div class="sign-col">
          <div class="sign-label" id="signTeamALabel">Đội trưởng A ký</div>
          <canvas class="sign-canvas" id="sigCanvasA" width="250" height="120"></canvas>
          <button class="btn ghost tiny" data-clear="A">Xoá ký A</button>
        </div>

        <div class="sign-col">
          <div class="sign-label" id="signTeamBLabel">Đội trưởng B ký</div>
          <canvas class="sign-canvas" id="sigCanvasB" width="250" height="120"></canvas>
          <button class="btn ghost tiny" data-clear="B">Xoá ký B</button>
        </div>

        <div class="sign-col">
          <div class="sign-label">Trọng tài ký</div>
          <canvas class="sign-canvas" id="sigCanvasRef" width="250" height="120"></canvas>
          <button class="btn ghost tiny" data-clear="R">Xoá ký TT</button>
        </div>
      </div>

      <div class="mt16 note-block">
        Dùng chuột (máy tính) hoặc ngón tay (điện thoại) để ký trực tiếp vào ô.
      </div>

      <div class="modal-footer mt16">
        <button id="btnFinishMatch" class="btn green">Hoàn tất trận đấu</button>
      </div>
    </div>
  </div>
</div>

<!-- toast -->
<div id="toast">Saved</div>

<script src="script.js"></script>
</body>
</html>
